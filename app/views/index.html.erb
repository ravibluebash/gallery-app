<% content_for :top_content do %>
    <div class="jumbotron">
      <div class="container">
        <h1>Welcome!</h1>
        <p>Register to get started.</p>
        <p>
          <%= link_to 'Register', new_user_registration_path, class: 'btn btn-primary btn-lg' %>
        </p>
      </div>
    </div>
  <% end %>

  





  ####################
  <div class="card-deck">
          <%# 
              <img class="card-img-top" src="1.jpg"> %>
          <%# 
              <%@album.images.first%> 
          <div class="card-body">
            <h5 class="card-title">
              <td>
                <%= album.title %>
                  </td>
            </h5>
            <p class="card-text">
              <td>
                <%= album.content %>
                  </td>
            </p>
            <%# <%= image_tag ("1.jpg"), class: "img-responsive" %> 
              </div>
            <div class="shadow-lg p-3 mb-5 bg-white rounded">
              <div class="card-footer">
                <h6 class="card-title">
                  <td>
                    
                    <div class="d-flex flex-column align-items-center justify-content-between">
                    <% album.tags.each do |tag| %>
                      <p>
                        <strong>#
                        </strong>
                        <%= tag.name %>
                          </div>
                      </p>


                      <div class="d-flex flex-row align-items-center my-3 justify-content-center">
                      <td style="padding: 20px" >
                        <%= link_to ' Edit ', edit_album_path(album), class:"btn btn-outline-success btn-pill mr-3 px-4 float - top" %>
                          </td>
                      <td>
                        <%= link_to ' View' , album_path(album),class:"btn btn-outline-primary btn-pill mr-3 px-4" %>
                          </td>
                      <td>
                        <%= link_to "Delete", 
                           album_path(album), class:"btn btn-outline-danger btn-pill mr-3",
                           method: :delete , 
                           data: { confirm: 'Are you sure?' }, 
                           no_text: true %>
                          </td>
                        <form>
                        <div class="form-group">
                          <input type="password" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Add Tag">
                        </div>
                        <button type="submit" class="btn btn-primary">Submit
                        </button>
                      </form>  
                    </div>
                </div>
                    
                    <% end %>



















<div class="card">
     <%= link_to album_path(album) do %>
        <%= image_tag ("1.jpg"), class: "img-responsive" %>
    <% end %>
    <div class="card-body">
      <h5 class="card-title"><%= album.title %></h5>
      <p class="card-text"><%= album.content %></p>
      <p class="card-text"><small class="text-muted"><%= link_to ' Edit ', 
      edit_album_path(album), 
      class:"btn btn-outline-success btn-pill mr-3 px-4 float - top" %>
      </small>
      <%= link_to "Delete", 
                           album_path(album), class:"btn btn-outline-danger btn-pill mr-3",
                           method: :delete , 
                           data: { confirm: 'Are you sure?' }, 
                           no_text: true %>
      </p>
      
      </small></p>

    </div>
  </div>
  <div class="card">
     <%= link_to album_path(album) do %>
        <%= image_tag ("1.jpg"), class: "img-responsive" %>
    <% end %>
    <div class="card-body">
      <h5 class="card-title"><%= album.title %></h5>
      <p class="card-text"><%= album.content %></p>
      <p class="card-text"><small class="text-muted"><%= link_to ' Edit ', 
      edit_album_path(album), 
      class:"btn btn-outline-success btn-pill mr-3 px-4 float - top" %>
      </small>
      <%= link_to "Delete", 
                           album_path(album), class:"btn btn-outline-danger btn-pill mr-3",
                           method: :delete , 
                           data: { confirm: 'Are you sure?' }, 
                           no_text: true %>
      </p>
      
      </small></p>

    </div>
  </div>

<%# 
        <table class='table table-striped table-dark"'> %>
    <%# 
        <thead class="thead-dark"> %>
    <%# 
        <tr> %>
    <%# 
        <th >Title
    </th> %>
  <%# 
      <th >Description
  </th> %>
<%# 
    <th colspan="3" style="width: 150px;">Operations
</th> %>
<%# 
    </tr> %>
<%# 
    </thead> %>
<% @albums.in_groups_of(3) do |albums|  %>
    <% @albums.each do |album| %>
      <div class="shadow-lg p-3 mb-5 bg-white rounded">  
        <div class="card-deck">
            <div class="card">
              <div class="card-body">
                <%= link_to album_path(album) do %>
                  <%= image_tag ("1.jpg"), class: "img-responsive" %>   
                <% end %>
              <h5 class="card-title"><%= album.title %></h5>
              <p class="card-text"><%= album.content %></p>
              <p class="card-text"><small class="text-muted"><%= link_to ' Edit ', 
              edit_album_path(album), 
              class:"btn btn-outline-success btn-pill mr-3 px-4 float - top" %>
              </small>
              <%= link_to "Delete", 
                                  album_path(album), class:"btn btn-outline-danger btn-pill mr-3",
                                  method: :delete , 
                                  data: { confirm: 'Are you sure?' }, 
                                  no_text: true %>
              </p>
              <%end%>
      
      </small></p>
      
    </div>
  </div>
  
</div>
                      
                      </td>
                  </h5> 
              </div>
            </div>
          </div>
        </div>
      </div>
  </div>
  <%# 
      <td > 
  <%= button_to ' Delete ', album_path(album),
     method: :delete,
     data: { confirm: 'Are you sure?' }
     %>
    </tr>
  <% end %>
    <%# 
        </table> %>
    











<div class='row'>
      <% @album.tags.each do |tag| %>  
    <div class='col-1 text-center'>
    
    <p> <%= link_to tag.name , edit_album_tag_path(tag)%>  </p>
      </div>
      <% end %>
    </div>











#######################


<div class='container'>
<%= link_to 'Edit', edit_album_path(@album),style:"float: right;" ,class:"btn btn-outline-success btn-pill px-4  "%> 


<%= link_to 'Back', albums_path ,style:"float: right;" ,class:"btn btn-outline-primary btn-pill px-3  "%>
<div style="text-align: left">


<p>
  <h5><strong>Title:</strong></h5>
  <br>
  <h6 class="font-weight-light "><%= @album.try(:title) %></h6>
</p>
 
<p>
  <h5><strong>Description:</strong></h5>
  <br>
  <h6 class="font-weight-light "><%= @album.try(:content) %></h6>
</p>


</div>
</div>
  
  <%# <body>  
      <div class="row"> 
          <div class="column">
          <% @album.images.each do |image| %>
            <%# <%= image_tag(image, :size => "300x280", :class => "img-responsive" )   %> 
          <%# <% end %> 
          <%# <br> %>
          <%# </div> %>
          
      <%# </div> %>
  <%# </body>     %> 


<div class="container">

  <h4 class="font-weight-light text-center text-lg-left mt-4 mb-0">Images</h1>


  <hr class="mt-2 mb-5">

  <div class="row text-center text-lg-left">
    <% @album.images.each do |image| %>
    <div class="col-lg-3 col-md-4 col-6">
    
      <a href="#" class="d-block mb-4 h-100">
            
            <%= image_tag(image, :class => "img-fluid img-thumbnail", :alt =>'' )   %>

          </a>
    </div>
    <% end %>
    
    </div>




  <strong><h5>Tags</h5></strong>
     <div class='row'>
        <% @album.tags.each do |tag| %>  
      <div class='col-1 text-center'>
    
        <p> <%= link_to tag.name , edit_album_tag_path(tag)%>  </p>
      </div>
        <% end %>
    
      <%= @album.tags.join(',')  %>  
     

    </div>
    
        <%if tag.id.present?%>
          <%# <%= link_to 'Edit', edit_album_tag_path(@album,tag) %> 
        <%end%>
    
  </div>




############################new.html.erb

<div class='container'>
<%= link_to 'Back', albums_path ,style:"float: right;" ,class:"btn btn-outline-primary btn-pill px-3  "%>

</div>
<div class='container'>
<form>
<h3>New Album</h3>
<%= form_with scope: :album, url: albums_path, local: true do |form| %>   
   <div class='form-group'>
    <p>
      <%= form.label :title %><br>
      <%= form.text_field :title ,:class=>"form-control"  %>
    </p>
   </div>
   <div class='form-group'>
    <p>
      <%= form.label :content %><br>
      <%= form.text_area :content ,:class=>"form-control"  %>
    </p>
    </div>
    <br>
    <%= form.hidden_field :user_id, value: current_user.id %>

    <%= form.file_field :images, id:"file-input" ,multiple: true ,:style=>"margin:15px;"%>

    <br>

    <%= form.submit :class=>"btn btn-outline-success btn-pill px-4"%>
     
  <% end %>

   
</form>

</div>
##########################edit.html.erb
<div class='container'>
<%= link_to 'Back', albums_path ,style:"float: right;" ,class:"btn btn-outline-primary btn-pill px-3  "%>
</div>
<div class='container'>
<h3>Edit Album</h3>
<form>
<%= form_with scope: :album, url: albums_path, local: true do |form| %>   
   <div class='form-group'>
    <p>
      <%= form.label :title %><br>
      <%= form.text_field :title ,:class=>"form-control"  %>
    </p>
   </div>
   <div class='form-group'>
    <p>
      <%= form.label :content %><br>
      <%= form.text_area :content ,:class=>"form-control"  %>
    </p>
    </div>
    <br>
    <%= form.hidden_field :user_id, value: current_user.id %>

    <%= form.file_field :images, id:"file-input" ,multiple: true,:style=>"margin:15px;" %>
    <br>


    <%= form.submit :class=>"btn btn-outline-success btn-pill px-4"%>
  <% end %>
</form>
</div>





#######################################################

class Admin::AlbumsController < ApplicationController
  before_action :find_album, only: [:edit, :update, :destroy, :show,:remove_image,:set_search]
  helper_method :current_user
  protect_from_forgery
    def index
      params[:q] ||= {}
      # @albums = current_user.albums
      # byebug
      @albums = current_user.albums

      if @albums.present?
        @search = @albums.ransack(params[:q])
        @albums = @search.result(distinct: true).page(params[:page]).per(3)
      end
    end

    def create
      @album = Album.new(album_params)
      if @album.save
        redirect_to @album
      else
        render :new
      end
    end

    def new
      @album = Album.new
      # byebug
    end
    # def show
    #   @posts = @topic.posts.page(params[:page]).per(2)
    # end  
    def update
      if @album.update(album_params)
        redirect_to @album
      else
        render 'edit'
      end
    end
    
    def destroy
      @album.destroy!
      redirect_to '/albums', :notice => "Your album has been deleted"
    end

    def remove_image
      @image=@album.images.find_by_id(params[:image_id])
      @image.destroy!
      redirect_to '/albums', :notice =>"Your image has been removed"
    end  

    def set_search

      @q = @album.tags.ransack(params[:image_id])
      @tags=@q.result(distinct: true)
    end   

    # def current_user
    #   @current_user ||= User.find(session[:user_id]) if session[:user_id]
    # end
    # don't forget this line too 
    private 
    def album_params      
      params.require(:album).permit(:id, :title, :content, :user_id,images: [])     
    end

    def find_album
      @album = Album.find(params[:id])
      # @album = current_user.albums.find(params[:id])
    end  
  end


  
































